<!DOCTYPE html>
<html lang="en">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="Spring框架：IoC、AOP、JdbcTemplate、事务管理、Spring5新特性"/>




  <meta name="keywords" content="Java,Spring," />





  <link rel="alternate" href="/paranoiddemon.github.io/atom.xml" title="LANDFILL">




  <link rel="shortcut icon" type="image/x-icon" href="/paranoiddemon.github.io/favicon.ico?v=1.1" />



<link rel="canonical" href="http://landfill.cc/posts/springframework-notes.html"/>


<meta name="description" content="Spring框架：IoC、AOP、JdbcTemplate、事务管理、Spring5新特性">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring 框架初步">
<meta property="og:url" content="http://landfill.cc/posts/springframework-notes">
<meta property="og:site_name" content="LANDFILL">
<meta property="og:description" content="Spring框架：IoC、AOP、JdbcTemplate、事务管理、Spring5新特性">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2020/07/18/aQGSLj2DVoY89h5.jpg">
<meta property="og:image" content="https://i.loli.net/2020/07/18/jp8yt3rkK1W9ZQS.png">
<meta property="article:published_time" content="2020-07-18T16:30:46.000Z">
<meta property="article:modified_time" content="2020-07-19T02:35:24.187Z">
<meta property="article:author" content="Demon">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/07/18/aQGSLj2DVoY89h5.jpg">


<link rel="stylesheet" type="text/css" href="/paranoiddemon.github.io/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>


  <link rel="stylesheet" type="text/css" href="/paranoiddemon.github.io/lib/fancybox/jquery.fancybox.css" />




<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: true
    },
  };
</script>




  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?87e8c69825473c3f40a93644c2765447";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172058533-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172058533-1');
</script>


    <title> Spring 框架初步 - LANDFILL </title>
  <meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/paranoiddemon.github.io/atom.xml" title="LANDFILL" type="application/atom+xml">
</head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/paranoiddemon.github.io/." class="logo">LANDFILL</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/paranoiddemon.github.io/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/paranoiddemon.github.io/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Spring 框架初步
        
      </h1>

      <time class="post-time">
          Jul 19 2020
      </time>
    </header>



    
            <div class="post-content">
            <h2 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h2><h3 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h3><ul>
<li><p>轻量级（引用的jar包少），开源，JavaEE框架</p>
</li>
<li><p>解决企业应用开发的复杂性</p>
</li>
<li><p>两个核心部分 IoC AOP</p>
<ul>
<li>IoC  Inversion of Control 把创建对象的过程交给Spring管理</li>
<li>AOP  Aspect Oriented Programing 不修改源代码的情况下进行功能增强<br><img src="https://i.loli.net/2020/07/18/aQGSLj2DVoY89h5.jpg" alt="Spring5模块"></li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li>方便解耦，简化开发，对象之间的调用由spring进行</li>
<li>方便测试</li>
<li>AOP编程支持   </li>
<li>方便和其他框架（mybatis etc.)整合</li>
<li>方便事务操作</li>
<li>降低API开发难度</li>
<li>源码设计值得学习</li>
</ul>
<p>环境：Spring 5.x</p>
</li>
</ul>
<h3 id="1-2-入门案例"><a href="#1-2-入门案例" class="headerlink" title="1.2 入门案例"></a>1.2 入门案例</h3><p>1、下载<br>2、创建工程<br>3、导入相关jar包<br><a href="xxxx.xx">Spring模块</a><br>4、创建一个类，写一个方法<br>5、编写Spring配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置User对象创建--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.UserDao"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>6、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//加载配置文件</span></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean1.xml"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取配置创建对象</span></span><br><span class="line">    User user = context.getBean(<span class="string">"user"</span>, User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    System.out.println(user);</span><br><span class="line">    user.add();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2、IoC-容器"><a href="#2、IoC-容器" class="headerlink" title="2、IoC 容器"></a>2、IoC 容器</h2><h3 id="2-1-底层原理"><a href="#2-1-底层原理" class="headerlink" title="2.1 底层原理"></a>2.1 底层原理</h3><p>（1）控制反转，把对象创建和对象之间的调用过程，交给Spring进行管理<br>（2）目的：为了降低耦合度<br>（3）原理<br>基于：xml解析、工厂模式、反射<br>在一个类中new另一个类的对象和方法，一旦另一个类变化，该类要跟着调整代码，耦合度过高。进一步地解耦<br>工作流程：<br>1、配置xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.UserDao"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、创建工厂类，通过xml parse来获取 前面配置的class全类名的值，通过反射来创建对象，通过BeanFactory来new对象传给调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserFactory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserDao <span class="title">getDao</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String classValue = <span class="string">"cc.landfill.spring.UserDao"</span>; <span class="comment">//xml解析获得</span></span><br><span class="line">        Class clazz = Class.forName(classValue);</span><br><span class="line">        <span class="keyword">return</span> (UserDao)clazz.newInstance();  <span class="comment">//通过反射来new对象</span></span><br><span class="line">&#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-IoC接口-BeanFactory"><a href="#2-2-IoC接口-BeanFactory" class="headerlink" title="2.2 IoC接口 BeanFactory"></a>2.2 IoC接口 BeanFactory</h3><p>IoC思想基于IoC容器完成，底层本质是对象工厂<br>Spring提供了IoC容器实现的两种方式（两个接口）：</p>
<ul>
<li>BeanFactory:IoC容器基本实现，是Spring内部使用的接口，不提供开发人员进行使用<ul>
<li>加载配置文件的时候不会创建对象，使用的时候才去创建对象，//和jdk8以后的StringBuffer一样,延迟创建</li>
</ul>
</li>
<li>ApplicationContext：继承了BeanFactory，提供更多更强大的功能，开发人员使用<ul>
<li>一加载配置文件就会创建对象，在实际开发中，这种更加实用，在服务器启动的时候就创建</li>
<li>实现类<ul>
<li>ClassPathXmlApplicationContext  配置文件在src下可以直接读取</li>
<li>FileSystemXmlApplicationContext 需要配置文件的全路径</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-3-IoC操作-Bean管理-基于xml"><a href="#2-3-IoC操作-Bean管理-基于xml" class="headerlink" title="2.3 IoC操作 Bean管理 基于xml"></a>2.3 IoC操作 Bean管理 基于xml</h3><h4 id="（1）Bean管理是什么"><a href="#（1）Bean管理是什么" class="headerlink" title="（1）Bean管理是什么"></a>（1）Bean管理是什么</h4><p>​    两种操作：</p>
<ul>
<li>Spring创建对象</li>
<li>Spring注入属性：set field value</li>
</ul>
<h4 id="（2）两种实现方式"><a href="#（2）两种实现方式" class="headerlink" title="（2）两种实现方式"></a>（2）两种实现方式</h4><ul>
<li>xml配置</li>
<li>注解</li>
</ul>
<h4 id="（3）基于xml注入"><a href="#（3）基于xml注入" class="headerlink" title="（3）基于xml注入"></a>（3）基于xml注入</h4><h5 id="基于xml创建对象：使用"><a href="#基于xml创建对象：使用" class="headerlink" title="基于xml创建对象：使用"></a>基于xml创建对象：使用<bean></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.UserDao"</span>/&gt;</span></span><br><span class="line">a) 在<span class="tag">&lt;<span class="name">bean</span>&gt;</span>中有很多属性，常用的有：</span><br><span class="line">   - id属性：给对象一个唯一的标识 </span><br><span class="line">   - class属性：创建对象所在类的全路径</span><br><span class="line">   - name属性：可以加特殊符号，早起Struts使用，现较少使用</span><br><span class="line">b) 创建对象的是默认调用的是无参构造器</span><br></pre></td></tr></table></figure>

<h5 id="基于xml注入属性"><a href="#基于xml注入属性" class="headerlink" title="基于xml注入属性"></a>基于xml注入属性</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- DI（Dependency Injection）: 依赖注入，就是注入属性 </span><br><span class="line">- 之前的方法：setter 和 带参构造器</span><br><span class="line">    @Data</span><br><span class="line">    public class Book &#123;</span><br><span class="line">        private String bookName;</span><br><span class="line">    </span><br><span class="line">        public Book(String bookName)&#123;</span><br><span class="line">            this.bookName = bookName;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public static void main(String[] args) &#123;</span><br><span class="line">            Book book = new Book();</span><br><span class="line">            book.setBookName("what");</span><br><span class="line">    </span><br><span class="line">            Book the_hell = new Book("the hell");</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">- 使用xml 对应setter和有参构造</span><br><span class="line"> <span class="comment">&lt;!--set方法注入属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.Book"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用property标签注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"bookName"</span> <span class="attr">value</span>=<span class="string">"Communist Manifesto"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"bookAuthor"</span> <span class="attr">value</span>=<span class="string">"Karl Marx"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--使用有参构造器注入属性，也可以使用参数索引。默认是无参创建对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"order"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.Orders"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"orderName"</span> <span class="attr">value</span>=<span class="string">"iPhone"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"China"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">- p名称空间注入属性 【了解】</span><br><span class="line">   使用p名称空间注入，可以简化xml的配置        </span><br><span class="line">   需要先在xml约束中增加p名称空间  xmlns:p="http://www.springframework.org/schema/p"</span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.Book"</span> <span class="attr">p:bookName</span>=<span class="string">"Communist Manifesto"</span> <span class="attr">p:bookAuthor</span>=<span class="string">"Karl Marx"</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="xml注入其他类型属性"><a href="#xml注入其他类型属性" class="headerlink" title="xml注入其他类型属性"></a>xml注入其他类型属性</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">a)字面量</span><br><span class="line">- null</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">- 属性值包含特殊符号</span><br><span class="line">    <span class="comment">&lt;!--包含特殊符号的属性值</span></span><br><span class="line"><span class="comment">        1、&amp;lt; &amp;gt;转义</span></span><br><span class="line"><span class="comment">        2、CDATA空间 jsp里的 &lt;![CDATA[原样输出的内容]]&gt;   </span></span><br><span class="line"><span class="comment">         好像还是转义符号方便点    </span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[&lt;&lt;北京&gt;&gt;]]&gt; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">b)注入外部bean   </span><br><span class="line">service类和dao类</span><br><span class="line">在service中调用dao里的方法</span><br><span class="line">在配置文件中配置两个类，把UserDao对象注入到UserService对象</span><br><span class="line">    UserService.java:</span><br><span class="line">     private UserDao userDao;</span><br><span class="line">    XML:</span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.cc.landfill.service.UserService"</span> &gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userDao"</span> <span class="attr">ref</span>=<span class="string">"userDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>  <span class="comment">&lt;!--引用要注入类的id--&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.cc.landfill.dao.UserDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  <span class="comment">&lt;!--得找实现类，接口没对象--&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c)内部bean</span><br><span class="line">一对多关系。在实体类中表示一对多的关系</span><br><span class="line">建立实体类</span><br><span class="line">配置xml</span><br><span class="line"><span class="comment">&lt;!--内部bean,嵌套一个bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"emp"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.bean.Emp"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"empName"</span> <span class="attr">value</span>=<span class="string">"jack"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"female"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dept"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dept"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.bean.Dept"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deptName"</span> <span class="attr">value</span>=<span class="string">"hr"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">上面这种就是级联赋值</span><br><span class="line">d)级联赋值</span><br><span class="line">在外部bean的基础上，给外部bean再去设置属性</span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"emp"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.bean.Emp"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"empName"</span> <span class="attr">value</span>=<span class="string">"jack"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"female"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dept"</span> <span class="attr">ref</span>=<span class="string">"dept"</span>&gt;</span>         </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dept"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.bean.Dept"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deptName"</span> <span class="attr">value</span>=<span class="string">"hr"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">方式二：</span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"emp"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.bean.Emp"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"empName"</span> <span class="attr">value</span>=<span class="string">"jack"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"female"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dept"</span> <span class="attr">ref</span>=<span class="string">"dept"</span>/&gt;</span>         </span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dept.deptName"</span> <span class="attr">value</span>=<span class="string">"it"</span>/&gt;</span>     以内部设置的值为准，需要有getter方法   </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dept"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.bean.Dept"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deptName"</span> <span class="attr">value</span>=<span class="string">"hr"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="xml注入集合类型属性"><a href="#xml注入集合类型属性" class="headerlink" title="xml注入集合类型属性"></a>xml注入集合类型属性</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">a)Array/List/Map/Set</span><br><span class="line"></span><br><span class="line">写实体类，至少有Setter方法</span><br><span class="line">配置xml注入</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.collection.Student"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--value只能注入一个值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"courses"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>java<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>database<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>jack<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>ma<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"JAVA"</span> <span class="attr">value</span>=<span class="string">"java"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"PYTHON"</span> <span class="attr">value</span>=<span class="string">"python"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span>        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"set"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>MySQL<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Redis<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">b)在集合里设置对象类型</span><br><span class="line"> private List<span class="tag">&lt;<span class="name">Course</span>&gt;</span> courseList;</span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"courseList"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"course1"</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"course2"</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--创建多个Course对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"course1"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.collection.Course"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"courseName"</span> <span class="attr">value</span>=<span class="string">"java"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"course2"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.collection.Course"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"courseName"</span> <span class="attr">value</span>=<span class="string">"python"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">c)提取集合注入部分 类似mybatis的sql片段</span><br><span class="line">- 引入名称空间util</span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">- 使用util标签完成list集合注入提取 map set properties constant都可以提取</span><br><span class="line"> <span class="comment">&lt;!--提取集合--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">"bookList"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>what<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>the hell<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.collection.Book"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span> <span class="attr">ref</span>=<span class="string">"bookList"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（4）FactoryBean"><a href="#（4）FactoryBean" class="headerlink" title="（4）FactoryBean"></a>（4）FactoryBean</h4><p>1、Spring有两种类型的Bean:普通Bean和工厂Bean（FactoryBean)</p>
<ul>
<li>普通Bean：定义什么类型，就返回什么类型（class的全类名）</li>
<li>FactoryBean：定义的类型和返回的类型可以是不一样的<br>2、步骤<br>创建类，作为工厂Bean，实现接口FactoryBean<br>实现接口的所有方法，在实现的方法中定义返回的Bean类型<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//自定义FactoryBean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Course</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义返回的对象</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Course <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Course course = <span class="keyword">new</span> Course();</span><br><span class="line">        course.setCourseName(<span class="string">"java"</span>);</span><br><span class="line">        <span class="keyword">return</span> course;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">     <span class="comment">//配置xml</span></span><br><span class="line">    &lt;bean id=<span class="string">"mybean"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cc.landfill.factorybean.MyBean"</span>/&gt;</span><br><span class="line">    <span class="comment">//测试</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">factoryBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean3.xml"</span>);</span><br><span class="line">        Course mybean = context.getBean(<span class="string">"mybean"</span>, Course<span class="class">.<span class="keyword">class</span>)</span>;  <span class="comment">//返回的类型要作为参数</span></span><br><span class="line"></span><br><span class="line">        System.out.println(mybean);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（5）Bean的作用域"><a href="#（5）Bean的作用域" class="headerlink" title="（5）Bean的作用域"></a>（5）Bean的作用域</h4><p>1、在Spring中，可以设置创建的Bean实例是单实例还是多实例,在默认情况下是单实例的,只在内存中创建一个对象<br>获取多次的地址值都是一样的<br>2、FactoryBean是多实例的。<br>3、如何设置<br>通过<bean>中的scope属性来设置：<br>singleton：默认值 单例 加载Spring配置文件的时候的就会创建该单实例对象<br>prototype：多实例 只有在调用getBean()的时候才会实例化<br>request  在web环境中可以使用，创建的对象会存到request域中<br>session  在web环境中可以使用，创建的对象会存到session域中</p>
<h4 id="（6）Bean的生命周期"><a href="#（6）Bean的生命周期" class="headerlink" title="（6）Bean的生命周期"></a>（6）Bean的生命周期</h4><p>从对象创建到对象销毁的过程 即为Bean的生命周期<br>    1 通过无参构造器实例化Bean<br>    2 为Bean的属性设置只和对其他Bean引用 调用set()<br>    3 把Bean的实例传递给Bean的后置处理器  postProcessBeforeInitialization()<br>    4 调用Bean的初始化的方法（需要进行配置）<br>    5 把Bean的实例传递给Bean的后置处理器 postProcessAfterInitialization()<br>    6 得到对象，使用Bean<br>    7 当容器关闭的时候，调用Bean的销毁方法（需要进行配置）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">实体类：要写初始化和销毁方法，在xml中配置</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Orders</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String orderName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Orders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"1 here is NoParamConstructor"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderName</span><span class="params">(String orderName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderName = orderName;</span><br><span class="line">        System.out.println(<span class="string">"2 here is setMethod"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建执行初始化的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"4 here is initMethod"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建执行销毁的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroyMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"7 here is destroyMethod"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">配置：初始化和销毁对象</span><br><span class="line">   &lt;bean id=<span class="string">"orders"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cc.landfill.bean.Orders"</span> init-method=<span class="string">"initMethod"</span> destroy-method=<span class="string">"destroyMethod"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"orderName"</span> value=<span class="string">"phone"</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">后置处理器</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"3 here is postProcessBeforeInitialization "</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"5 here is postProcessAfterInitialization "</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">测试：</span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lifeCycle</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean4.xml"</span>);</span><br><span class="line">        <span class="comment">//ApplicationContext context = new ClassPathXmlApplicationContext("bean4.xml"); //这个接口没有close()</span></span><br><span class="line"></span><br><span class="line">        Orders orders = context.getBean(<span class="string">"orders"</span>, Orders<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"6 get instance of bean"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//手动调用销毁方法</span></span><br><span class="line">        context.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line"> <span class="number">1</span> here is NoParamConstructor</span><br><span class="line"> <span class="number">2</span> here is setMethod</span><br><span class="line"> <span class="number">3</span> here is postProcessBeforeInitialization </span><br><span class="line"> <span class="number">4</span> here is initMethod</span><br><span class="line"> <span class="number">5</span> here is postProcessAfterInitialization </span><br><span class="line"> <span class="number">6</span> get instance of bean</span><br><span class="line"> <span class="number">7</span> here is destroyMethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="（7）xml自动装配"><a href="#（7）xml自动装配" class="headerlink" title="（7）xml自动装配"></a>（7）xml自动装配</h4><p>概念：根据指定装配规则（属性名称或者属性类型），Spring自动将匹配的属性值注入。但用的比较少。一般用注解自动装配<br>前面通过value 和 ref 来设置就是手动装配</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--自动装配</span></span><br><span class="line"><span class="comment">  autowire属性：</span></span><br><span class="line"><span class="comment">  byName  根据属性名称注入  注入bean的id值和 类属性名称要一致 如：要注入dept对象，在实体类中dept属性名，和配置文件中的bean id要一致</span></span><br><span class="line"><span class="comment">  byType  根据属性类型注入 如果定义了多个相同类型的Bean就会报错</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"emp"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.autowire.Emp"</span> <span class="attr">autowire</span>=<span class="string">"byName"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dept"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.autowire.Dept"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（8）引入外部的属性文件"><a href="#（8）引入外部的属性文件" class="headerlink" title="（8）引入外部的属性文件"></a>（8）引入外部的属性文件</h4><p>1、直接配置数据库信息<br>    配置连接池</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jc.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///user"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、引入外部属性文件配置<br>创建外部的属性文件 druid.properties<br>引入context名称空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/context  http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用标签引入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!--使用外部属性文件引入,不需要修改bean.xml,在配置文件中去修改--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:druid.properties"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource2"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-IoC操作-Bean管理-基于注解"><a href="#2-4-IoC操作-Bean管理-基于注解" class="headerlink" title="2.4 IoC操作 Bean管理 基于注解"></a>2.4 IoC操作 Bean管理 基于注解</h3><h4 id="（1）什么是注解："><a href="#（1）什么是注解：" class="headerlink" title="（1）什么是注解："></a>（1）什么是注解：</h4><p>注解是代码特殊标记 格式：@注解名称(属性名称1=属性值1,属性名称2=属性值2…)<br>注解可以作用在类、属性、方法上<br>使用目的：简化xml配置</p>
<h4 id="（2）Bean管理中创建对象的注解"><a href="#（2）Bean管理中创建对象的注解" class="headerlink" title="（2）Bean管理中创建对象的注解"></a>（2）Bean管理中创建对象的注解</h4><ul>
<li>@Component 普通的注解</li>
<li>@Service    业务逻辑层</li>
<li>@Controller  表示层</li>
<li>@Repository  持久层<br>功能是一样的，都可以用来创建对象，没有严格的区分，但是建议分别使用，更加清楚当前组件所扮演的角色</li>
</ul>
<h4 id="（3）基于注解创建对象"><a href="#（3）基于注解创建对象" class="headerlink" title="（3）基于注解创建对象"></a>（3）基于注解创建对象</h4><p>引入依赖  spring-aop-5.2.6.RELEASE.jar<br>开启组件扫描</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--开启组件扫描，指定扫描的包的名称</span></span><br><span class="line"><span class="comment">    多个包用逗号隔开，</span></span><br><span class="line"><span class="comment">    或者扫描上一层目录</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cc.landfill.spring.dao,cc.landfill.spring.service"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>在类上添加注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//value和bean标签中id是一个东西，但是可以省略，默认就是类名首字母小写</span></span><br><span class="line"><span class="meta">@Service</span>(value=<span class="string">"userService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"cc.landfill.service.add()..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">测试：</span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUserService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean1.xml"</span>);</span><br><span class="line">        UserService userService = context.getBean(<span class="string">"userService"</span>, UserService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        userService.add();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>过程：开启组件扫描 -&gt; 到指定的包扫描类 -&gt; 如果扫描到注解，利用反射实例化该类 -&gt; 通过getBean获取实例<br>如何理解注解？</p>
<p>扫描组件的详细配置:include和exclude<br>&lt;context:component-scan base-package=”cc.landfill.spring” use-default-filters=”false”&gt;<br>    &lt;context:include-filter type=”annotation” expression=”org.springframework.stereotype.Service”/&gt;<br>    &lt;context:exclude-filter type=”annotation” expression=”org.springframework.stereotype.Controller”/&gt;<br></context:component-scan></p>
<h4 id="（4）基于注解注入依赖"><a href="#（4）基于注解注入依赖" class="headerlink" title="（4）基于注解注入依赖"></a>（4）基于注解注入依赖</h4><p>@AutoWired  根据属性类型进行注入，自动装配<br>    在service和dao类上添加注解,实现这两个类的实例化<br>    在service注入dao对象,在service添加dao属性，在属性上方添加注解，不需要set方法</p>
<p>@Qualifier  根据属性的名称进行注入，<br>    需要和@AutoWired同时使用,如果一个接口有多个实现类，单独使用@AutoWired，就无法自动装配，名称是唯一标识符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(value=<span class="string">"userService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//根据类型进行装配</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(value = <span class="string">"userDaoImpl"</span>)</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"cc.landfill.service.add()..."</span>);</span><br><span class="line">        userDao.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Resource   根据类型和名称注入都可以</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span>默认按照ByName自动注入，由J2EE提供，需要导入包javax.annotation.Resource。</span><br><span class="line"><span class="meta">@Resource</span>有两个重要的属性：name和type，而Spring将<span class="meta">@Resource</span>注解的name属性解析为bean的名字，</span><br><span class="line">而type属性则解析为bean的类型。所以，如果使用name属性，则使用byName的自动注入策略，</span><br><span class="line">而使用type属性时则使用byType自动注入策略。如果既不制定name也不制定type属性，这时将通过反射机制使用byName自动注入策略。</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Resource</span>(name = <span class="string">"useDaoImpl"</span>)</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>

<p>@Value      注入普通类型属性<br>基本数据类型，String<br>直接在属性上方添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(value=<span class="string">"jack"</span>)</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(value=<span class="string">"13"</span>)</span><br><span class="line"><span class="keyword">private</span> String age;</span><br></pre></td></tr></table></figure>
<h4 id="（5）完全注解开发-创建对象和注入依赖"><a href="#（5）完全注解开发-创建对象和注入依赖" class="headerlink" title="（5）完全注解开发 创建对象和注入依赖"></a>（5）完全注解开发 创建对象和注入依赖</h4><p>实际应用中基于SpringBoot，本质上是Spring</p>
<p>创建配置类，替代xml文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//作为配置类 替代xml配置文件</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"cc.landfill.spring"</span>&#125;)     </span><br><span class="line"><span class="comment">//等价于xml中的&lt;context:component-scan base-package="cc.landfill.spring/&gt; 其实注解也是一种键值对</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUserService2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//加载配置类，和之前加载配置文件是一个功能</span></span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        UserService userService = context.getBean(<span class="string">"userService"</span>, UserService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        userService.add();</span><br><span class="line">        System.out.println(userService);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h2 id="3、AOP"><a href="#3、AOP" class="headerlink" title="3、AOP"></a>3、AOP</h2><h3 id="3-1-概念"><a href="#3-1-概念" class="headerlink" title="3.1 概念"></a>3.1 概念</h3><p>Aspect Oriented Programming<br>可以对业务逻辑的各个部分进行隔离，从而降低业务逻辑各部分间的耦合度，提高可重用性和开发效率<br>不改变原有代码，在原来的基础上添加新的功能，把模块配置到主模块中</p>
<h3 id="3-2-底层原理"><a href="#3-2-底层原理" class="headerlink" title="3.2 底层原理"></a>3.2 底层原理</h3><h4 id="（1）AOP底层使用动态代理"><a href="#（1）AOP底层使用动态代理" class="headerlink" title="（1）AOP底层使用动态代理"></a>（1）AOP底层使用动态代理</h4><p>有接口的情况：使用JDK动态代理，创建接口实现类的代理对象，既能完成原有的功能，又能做一些其他的功能<br>没有接口的情况：使用CGLIB动态代理 创建子类的代理对象</p>
<h4 id="（2）JDK动态代理"><a href="#（2）JDK动态代理" class="headerlink" title="（2）JDK动态代理"></a>（2）JDK动态代理</h4><p>使用Proxy类 newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h)<br>三个参数：<br>类加载器<br>增强方法所在类实现的接口（可以有多个）<br>InvocationHandler 接口，需要被实现，创建代理对象，写增强的方法。invocation: the act of making a particular function start</p>
<p>代码实现：<br>创建接口，定义方法<br>实现类<br>使用Proxy类创建代理对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDKProxy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//返回的是Object，强转。将代理对象实例化，通过代理类的有参构造器，传入了被代理类的实例，在调用被代理类的方法时，会直接去调用</span></span><br><span class="line">        <span class="comment">//InvocationHandler（即代理类）中的invoke方法,该invoke方法中，即实现了被代理类原有的方法，又实现了另外增强的方法</span></span><br><span class="line">        UserDao userDao = (UserDao) Proxy.newProxyInstance(JDKProxy.class.getClassLoader(), new Class[]&#123;UserDao.class&#125;, new UserDaoProxy(new UserDaoImpl()));</span><br><span class="line">        <span class="comment">//代理对象 调用add的时候，为什么会知道去执行invoke呢？应该需要有某种关联</span></span><br><span class="line">        <span class="keyword">int</span> sum = userDao.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//代理类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDaoProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span></span>&#123;</span><br><span class="line">    <span class="comment">//把被代理的对象传递过来</span></span><br><span class="line">    <span class="comment">//有参构造器</span></span><br><span class="line">    <span class="keyword">private</span> Object obj;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserDaoProxy</span><span class="params">(Object obj)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obj=obj;   <span class="comment">//这里的obj就是被代理的UserDao的对象，使用Object更通用</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//需要增强的逻辑</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(method.getName()+<span class="string">" "</span>+ Arrays.toString(args));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行的是被代理类本来的功能</span></span><br><span class="line">        Object retVal = method.invoke(obj, args); </span><br><span class="line">        <span class="comment">//因为有被代理类的全部信息，调用被代理类的方法的时候，判断调用的是什么方法，再去invoke这个方法，</span></span><br><span class="line">        <span class="comment">//它只是通过反射去调用，不需要自己实现逻辑。可是是怎么关联起来的?invoke里传入了对象，和参数</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//前后可以增加新的逻辑，而不影响原先的代码</span></span><br><span class="line">        System.out.println(obj.getClass());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（3）-常见术语"><a href="#（3）-常见术语" class="headerlink" title="（3） 常见术语"></a>（3） 常见术语</h4><p>连接点：类中可以被增强的方法<br>切入点：实际被真正增强的方法<br>通知（增强）：增强的逻辑的部分，有5种类型<br>    前置通知  @Before<br>    后置通知  @AfterReturning 在方法返回值之后，有异常不执行<br>    环绕通知 在被增强方法的前后都会执行 @Around 有异常环绕通知的后半部分不会执行<br>    异常通知 当被增强方法 出现异常的时候执行 @AfterThrowing 只有有异常才会执行<br>    最终通知 类似finally  @After在方法执行之后 无论是否有异常，都会执行<br>切面：把通知应用到切入点，是一个动作</p>
<h3 id="3-3-Spring中实现"><a href="#3-3-Spring中实现" class="headerlink" title="3.3 Spring中实现"></a>3.3 Spring中实现</h3><h4 id="（1）实现"><a href="#（1）实现" class="headerlink" title="（1）实现"></a>（1）实现</h4><p>一般基于AspectJ实现AOP操作：AspectJ不是Spring组成部分，独立的AOP框架，一般配合Spring使用，实现AOP操作<br>两种实现方式：<br>    基于xml<br>    基于注解（一般使用这种）</p>
<h4 id="（2）步骤（基于AspectJ-注解）："><a href="#（2）步骤（基于AspectJ-注解）：" class="headerlink" title="（2）步骤（基于AspectJ 注解）："></a>（2）步骤（基于AspectJ 注解）：</h4><h5 id="1-导入依赖-spring-aspects-5-2-6-RELEASE-jar"><a href="#1-导入依赖-spring-aspects-5-2-6-RELEASE-jar" class="headerlink" title="1. 导入依赖     spring-aspects-5.2.6.RELEASE.jar"></a>1. 导入依赖     spring-aspects-5.2.6.RELEASE.jar</h5><pre><code>spring-aop-5.2.6.RELEASE.jar
com.springsource.net.sf.cglib-2.2.0.jar
com.springsource.org.aopalliance-1.0.0.jar
com.springsource.org.aspectj.weaver-1.6.8.RELEASE.jar</code></pre><h5 id="2-切入点的表达式"><a href="#2-切入点的表达式" class="headerlink" title="2. 切入点的表达式"></a>2. 切入点的表达式</h5><pre><code>作用：对哪个类的哪个方法进行增强</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">语法结构：execution([权限修饰符][返回类型][全类名][方法名][参数列表])</span><br><span class="line">例：execution(* cc.landfill.spring.cc.landfill.dao.UserDao.add(..))   *表示所有权限修饰符，返回类型可以省略 ..表示参数列表</span><br><span class="line">例：execution(* cc.landfill.spring.cc.landfill.dao.UserDao.*(..))     对类中所有方法进行增强</span><br><span class="line">例：execution(* cc.landfill.spring.cc.landfill.dao.*.*(..))     对包中所有类中所有方法进行增强</span><br></pre></td></tr></table></figure>

<h5 id="3-AspectJ-注解"><a href="#3-AspectJ-注解" class="headerlink" title="3. AspectJ 注解"></a>3. AspectJ 注解</h5><p>创建类，定义方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被增强</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"User.add()..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-创建增强类（编写增强的逻辑），增加方法"><a href="#4-创建增强类（编写增强的逻辑），增加方法" class="headerlink" title="4. 创建增强类（编写增强的逻辑），增加方法"></a>4. 创建增强类（编写增强的逻辑），增加方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//增强的类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProxy</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//前置通知</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-进行通知的配置，根据功能选择通知类型"><a href="#5-进行通知的配置，根据功能选择通知类型" class="headerlink" title="5. 进行通知的配置，根据功能选择通知类型"></a>5. 进行通知的配置，根据功能选择通知类型</h5><ul>
<li>在Spring配置文件中，开启注解扫描</li>
<li>使用@Component注解创建User和UserProxy对象</li>
<li>在增强类上面添加注解@Aspect</li>
<li>在Spring配置文件中开启生成代理对象<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启注解扫描--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cc.landfill.spring.aop"</span>/&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">&lt;!--开启AspectJ生成代理对象,如果扫描发现@Aspect注解的类，就会为该类生成对象--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>配置不同类型的通知<br>在增强类里，在作为通知方法上面添加通知类型注解，使用切入点表达式<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">前置通知  <span class="meta">@Before</span></span><br><span class="line">    后置通知  <span class="meta">@AfterReturning</span> 在方法返回值之后，有异常不执行</span><br><span class="line">    环绕通知 在被增强方法的前后都会执行 <span class="meta">@Around</span> 有异常环绕通知的后半部分不会执行</span><br><span class="line">    异常通知 当被增强方法 出现异常的时候执行 <span class="meta">@AfterThrowing</span> 只有有异常才会执行</span><br><span class="line">    最终通知 类似<span class="keyword">finally</span>  <span class="meta">@After</span>在方法执行之后 无论是否有异常，都会执行</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span>  <span class="comment">//生成代理对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProxy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//前置通知 该注解为前置通知</span></span><br><span class="line">    <span class="meta">@Before</span>(value = <span class="string">"execution(* cc.landfill.spring.aop.UserProxy.before(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//环绕通知</span></span><br><span class="line">    <span class="meta">@Around</span>(value = <span class="string">"execution(* cc.landfill.spring.aop.User.add(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"before around()..."</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            proceedingJoinPoint.proceed();   <span class="comment">//执行被增强的方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"after around()..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="6-细节"><a href="#6-细节" class="headerlink" title="6. 细节"></a>6. 细节</h5></li>
<li>细节1：对相同切入点的抽取 PointCut<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProxy</span> </span>&#123;</span><br><span class="line">    <span class="comment">//相同切入点可以进行抽取,把公共的切入点表达式写到PointCut,在通知配置的时候，直接写抽取的方法名</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(value = <span class="string">"execution(* cc.landfill.spring.aop.User.add(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointDemo</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Before</span>(value = <span class="string">"pointDemo()"</span>) <span class="comment">//这里写的是切入点，不要搞错，写成通知了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"before()..."</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li>细节2：多个增强类，可以设置通知的优先级,添加@Order注解，值越小，优先级越高。设置了Order的优先级比没设置的高<pre><code>使用于增强类中所有的通知，能用在方法上吗？可以用在方法上。
显示默认比类上的Order，如果类上没有Order，应该是按首字母？
然后会按类中方法的Order去执行。执行完一个类，才会执行另一个类</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order</span>(value = <span class="number">1</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonProxy</span> </span>&#123;</span><br><span class="line">    <span class="comment">//都对add做增强，设置执行的优先级</span></span><br><span class="line">    <span class="meta">@Before</span>(value = <span class="string">"execution(* cc.landfill.spring.aop.User.add(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Person.before()..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（3）基于AspectJ-配置文件-【了解】"><a href="#（3）基于AspectJ-配置文件-【了解】" class="headerlink" title="（3）基于AspectJ 配置文件 【了解】"></a>（3）基于AspectJ 配置文件 【了解】</h4><p>【了解，实际使用注解方式较多】 步骤3的另一种实现方式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--创建对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.aopxml.Book"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bookProxy"</span> <span class="attr">class</span>=<span class="string">"cc.landfill.spring.aopxml.BookProxy"</span>/&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">&lt;!--配置aop增强--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--切入点--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"p"</span> <span class="attr">expression</span>=<span class="string">"execution(* cc.landfill.spring.aopxml.Book.buy())"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"bookProxy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--增强作用在具体的方法  把增强类的before() 配置在 被增强类的的p这个切入点的 前置通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut-ref</span>=<span class="string">"p"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="（4）完全基于注解的AOP"><a href="#（4）完全基于注解的AOP" class="headerlink" title="（4）完全基于注解的AOP"></a>（4）完全基于注解的AOP</h4><p>使用配置类,不需要任何xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>   <span class="comment">//声明是配置类</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"cc.landfill.spring"</span>&#125;)  <span class="comment">//开启组件扫描。数组，可以扫描多个包，扫描有注解的类</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>(proxyTargetClass = <span class="keyword">true</span>)  <span class="comment">//开启AspectJ来自动生成代理对象，默认值是true，可以省略括号</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 使用的时候：AnnotationConfigApplicationContext来获取context，来获取对象</span><br></pre></td></tr></table></figure>


<p>​<br>​    </p>
<h2 id="4、JdbcTemplate"><a href="#4、JdbcTemplate" class="headerlink" title="4、JdbcTemplate"></a>4、JdbcTemplate</h2><p>JdbcTemplate：对JDBC的操作进行了一些封装，方便操作数据库。也可以自己整合其他框架，如：Mybatis</p>
<h3 id="3-1-环境搭建"><a href="#3-1-环境搭建" class="headerlink" title="3.1 环境搭建"></a>3.1 环境搭建</h3><h4 id="1-引入相关的依赖"><a href="#1-引入相关的依赖" class="headerlink" title="1. 引入相关的依赖"></a>1. 引入相关的依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring-jdbc-5.2.6.RELEASE.jar</span><br><span class="line">spring-orm-5.2.6.RELEASE.jar</span><br><span class="line">spring-tx-5.2.6.RELEASE.jar</span><br><span class="line">mysql-connector-java-8.0.20.jar</span><br><span class="line">druid-1.1.9.jar</span><br></pre></td></tr></table></figure>
<h4 id="2-配置数据库连接池druid、配置JdbcTemplate-注入DataSource"><a href="#2-配置数据库连接池druid、配置JdbcTemplate-注入DataSource" class="headerlink" title="2. 配置数据库连接池druid、配置JdbcTemplate 注入DataSource"></a>2. 配置数据库连接池druid、配置JdbcTemplate 注入DataSource</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置数据库连接池--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///spring?serverTimezone=Asia/Shanghai"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--注入连接池对象到JdbcTemplate--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"template"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--通过set方法注入property, 不用constructor-arg，用了会咋样？--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-创建Service类和Dao类，在Dao实例注入JdbcTemplate对象，在Service实例注入Dao对象"><a href="#3-创建Service类和Dao类，在Dao实例注入JdbcTemplate对象，在Service实例注入Dao对象" class="headerlink" title="3. 创建Service类和Dao类，在Dao实例注入JdbcTemplate对象，在Service实例注入Dao对象"></a>3. 创建Service类和Dao类，在Dao实例注入JdbcTemplate对象，在Service实例注入Dao对象</h4><p>开启组件扫描<br>创建对象<br>注入依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">开启组件扫描</span><br><span class="line">&lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">"cc.landfill"</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title">BookDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate template;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-CRUD"><a href="#3-2-CRUD" class="headerlink" title="3.2 CRUD"></a>3.2 CRUD</h3><h4 id="（1）增删改"><a href="#（1）增删改" class="headerlink" title="（1）增删改"></a>（1）增删改</h4><p>都是类似的，使用update() 改一下sql语句，删参数传id就行了<br>创建一个实体类<br>jdbcTemplate.update(String sql,Object…args)  sql语句，占位符的可变参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title">BookDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"insert into book values(?,?,?)"</span>;</span><br><span class="line">        <span class="keyword">int</span> update = template.update(sql, book.getId(), book.getName(), book.getStatus());</span><br><span class="line">       <span class="comment">//两种写法都可以</span></span><br><span class="line"><span class="comment">//      int update = template.update(sql, new Object[]&#123;book.getId(), book.getName(), book.getStatus()&#125;);</span></span><br><span class="line">        System.out.println(update);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">测试：</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJdbcTemp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean1.xml"</span>);</span><br><span class="line">        BookService bookService = context.getBean(<span class="string">"bookService"</span>, BookService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        bookService.addBook(<span class="keyword">new</span> Book(<span class="string">"communist manifesto"</span>,<span class="number">1</span>,<span class="string">"sold out"</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="（2）查"><a href="#（2）查" class="headerlink" title="（2）查"></a>（2）查</h4><ol>
<li><p>查询某个值 如 select count(*) from book<br>调用JdbcTemplate的queryForObject(String sql,Class clazz) 返回类型</p>
</li>
<li><p>查询返回对象<br>调用JdbcTemplate的queryForObject(String sql,RowMapper<T> rowMapper, Object…args)<br>RowMapper mapper = new BeanPropertyRowMapper<Book>(Book.class) 把查询结果的数据封装到泛型指定的类中<br>RowMapper接口，返回不同类型的数据，使用这个接口里面的实现类完成数据的封装，也可以自定义实现类</p>
</li>
<li><p>查询返回集合<br>查出列表<br>调用JdbcTemplate的query(String sql,RowMapper<T> rowMapper, Object…args)<br>没有参数可以省略<br>List<Book> bookList = template.query(String sql,new BeanPropertyRowMapper<Book>(Book.class))<br>返回的是list 每条记录放到对象，对象再放到list</p>
</li>
</ol>
<h4 id="（3）批量操作"><a href="#（3）批量操作" class="headerlink" title="（3）批量操作"></a>（3）批量操作</h4><p>1.批量添加<br>batchUpdate(String sql, List&lt;Object[]&gt; batchArgs)<br>Object[] 存放的是每条记录的 各个字段的值<br>List 是多个Object[]构成的多条记录</p>
<p>在DaoImpl传入参数List&lt;Object[]&gt; batchArgs</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"insert into book values(?,?,?)"</span></span><br><span class="line">template.batchUpdate(sql,batchArgs);</span><br></pre></td></tr></table></figure>
<p>遍历list，然后对每个Object数组执行sql语句<br>2.批量修改和批量删除<br>和批量添加操作类似<br>new ArrayList<br>按占位符的顺序  创建数组<br>把数组add到list</p>
<p>删除的话，数组就一个id元素</p>
<h2 id="5、事务管理"><a href="#5、事务管理" class="headerlink" title="5、事务管理"></a>5、事务管理</h2><h3 id="5-1-概念"><a href="#5-1-概念" class="headerlink" title="5.1 概念"></a>5.1 概念</h3><p>数据库操作最基本的单元，逻辑上的一组操作，要么都成功，一个失败所有操作都失败</p>
<p>ACID 事务的特性<br>atomicity    最基本的单元<br>consistency  操作前后的数据是一致的<br>isolation     在不同事务操作之间互不影响<br>durability   一旦提交就发生改变，无法回到之前的状态</p>
<h3 id="5-2-事务环境搭建"><a href="#5-2-事务环境搭建" class="headerlink" title="5.2 事务环境搭建"></a>5.2 事务环境搭建</h3><p>数据库环境<br>完成对象的创建和依赖注入</p>
<h3 id="5-3-事务管理"><a href="#5-3-事务管理" class="headerlink" title="5.3 事务管理"></a>5.3 事务管理</h3><h4 id="（1）概念"><a href="#（1）概念" class="headerlink" title="（1）概念"></a>（1）概念</h4><p>事务一般添加到Service层<br>在Spring中进行事务管理操作有两种方式</p>
<ul>
<li>编程式</li>
<li>声明式（一般使用）<ul>
<li>基于注解（使用）</li>
<li>基于xml文件</li>
</ul>
</li>
</ul>
<p>声明式事务管理，底层使用的是AOP</p>
<p>Spring事务管理API<br>提供一个接口，代表事务管理器，这个接口针对不同框架提供不同的实现类<br>PlatformTransactionManager 接口<br>DataSourceTransactionManager  实现类： mybatis和JdbcTemplate都是使用这个类</p>
<h4 id="（2）注解实现声明式事务管理"><a href="#（2）注解实现声明式事务管理" class="headerlink" title="（2）注解实现声明式事务管理"></a>（2）注解实现声明式事务管理</h4><ol>
<li><p>在spring配置文件中 配置事务管理器<br>DataSourceTransactionManager </p>
</li>
<li><p>开启事务的注解</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--创建事务管理器--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManger"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--注入dataSource--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">       </span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--引入tx名称空间，开启事务管理注解--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManger"</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在Service层的类上添加事务注解 @Transactional<br>可以在类上 和 方法上 添加该注解<br>类上：表示类中的所有方法都添加了事务<br>方法上：只针对该方法开启事务</p>
</li>
<li><p>关于事务的参数配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(readOnly = <span class="keyword">false</span>,timeout = -<span class="number">1</span>,propagation = Propagation.REQUIRED,isolation = Isolation.REPEATABLE_READ)</span><br><span class="line"><span class="meta">@Transactional</span>(rollbackFor=Exception<span class="class">.<span class="keyword">class</span>)</span></span><br></pre></td></tr></table></figure>
<p>propagation 传播行为有7种 事务方法：对数据库增删改导致数据进行变化的操作。传播行为：多事务方法进行互相调用的过程中，事务如何进行处理</p>
<ul>
<li>REQUIRED 有事务就在当前事务中运行，没有就新建一个事务。在一个事务方法中去，调用另一个事务</li>
<li>REQUIRED_NEW</li>
<li>SUPPORTS</li>
<li>NOT_SUPPORTED</li>
<li>MANDATORY</li>
<li>NEVER</li>
<li>NESTED<br>isolation 隔离级别 在多事务操作之间不会产生影响。<br>问题：</li>
<li>脏读 不同事务之间可以读到还没有提交的数据，一旦回滚，读到的数据就是暂时的</li>
<li>幻读 一个未提交的事务读取到另一事务添加的数据</li>
<li>不可重复读 一个未提交事务读取了提交的事务修改的数据，每次读到的数据都不一样。<br>通过设置事务的隔离级别来解决这些问题<br><img src="https://i.loli.net/2020/07/18/jp8yt3rkK1W9ZQS.png" alt="数据库隔离级别"><br>MySQL默认使用的是REPEATABLE_READ<br>timeout 规定时间内要进行提交，一旦超出时间不提交就会回滚  默认是-1 没有超时时间 以秒为单位<br>readOnly 是否只读  读：查询操作，默认值是false，可以进行增删改查。设置为true只能做查询操作<br>rollBackFor  出现哪些异常会进行回滚<br>noRollBackFor 出现哪些异常不进行回滚</li>
</ul>
</li>
</ol>
<h4 id="（3）基于xml实现声明式事务管理"><a href="#（3）基于xml实现声明式事务管理" class="headerlink" title="（3）基于xml实现声明式事务管理"></a>（3）基于xml实现声明式事务管理</h4><p>配置事务管理器</p>
<p>配置通知 （事务）</p>
<p>配置切入点和切面 （添加事务的位置）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--创建事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--注入dataSource--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置事务的通知--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txadvice"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定按某种规则（可以使用通配符）的方法上面添加事务  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"transact"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span><span class="comment">&lt;!--其他参数也是在这里配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--配置切入点和切面--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切入点表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* cc.landfill.service.AccountService.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切面,把事务的通知设置到切入点上，就完成了切面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txadvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="（4）完全注解实现声明式事务管理"><a href="#（4）完全注解实现声明式事务管理" class="headerlink" title="（4）完全注解实现声明式事务管理"></a>（4）完全注解实现声明式事务管理</h4><p>配置类替代xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">//声明为配置文件</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"cc.landfill"</span>) <span class="comment">//组件扫描</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">//开启事务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxConfig</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建数据库连接池对象</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DruidDataSource <span class="title">getDruidDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        dataSource.setDriverClassName(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);</span><br><span class="line">        dataSource.setUrl(<span class="string">"jdbc:mysql:///spring?serverTimezone=Asia/Shanghai"</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">"root"</span>);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建JdbcTemplate对象</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">getJdbcTemplate</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line">        JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate();</span><br><span class="line">        </span><br><span class="line">        jdbcTemplate.setDataSource(dataSource); <span class="comment">//根据类型自动装配,在ioc容器中去找该类型的对象</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建事务管理器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">getDataSourceTransactionManager</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line">        DataSourceTransactionManager transactionManager = <span class="keyword">new</span> DataSourceTransactionManager();</span><br><span class="line">        transactionManager.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> transactionManager;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6、Spring5-新特性"><a href="#6、Spring5-新特性" class="headerlink" title="6、Spring5 新特性"></a>6、Spring5 新特性</h2><p>Spring5 基于jdk8 运行时兼容jdk9</p>
<h3 id="6-1-log4j2整合"><a href="#6-1-log4j2整合" class="headerlink" title="6.1 log4j2整合"></a>6.1 log4j2整合</h3><p>自带了通用的日志封装<br>移除了Log4jConfigListener，官方建议使用Log4j2</p>
<p>第一步：引入jar包<br>log4j-api-2.11.2.jar<br>log4j-core-2.11.2.jar<br>log4j-slf4j-impl-2.11.2.jar<br>slf4j-api-1.7.30.jar</p>
<p>第二步：创建log4j2.xml配置文件 名称是规定的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Configuration后面的status用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，可以看到log4j2内部各种详细输出--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">status</span>=<span class="string">"INFO"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--先定义所有的appender--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--输出日志信息到控制台--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">console</span> <span class="attr">name</span>=<span class="string">"Console"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--控制日志输出的格式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--然后定义logger，只有定义了logger并引入的appender，appender才会生效--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--root：用于指定项目的根日志，如果没有单独指定Logger，则会使用root作为默认的日志输出--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"info"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-2-Nullable注解"><a href="#6-2-Nullable注解" class="headerlink" title="6.2 @Nullable注解"></a>6.2 @Nullable注解</h3><p>可以使用在方法、属性、参数上，表示方法返回、属性值、参数值可以为空 类似Guava的Optional?<br>可以避免空指针异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">(@Nullable String name)</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-核心容器支持函数式风格-GenericApplicationContext"><a href="#6-3-核心容器支持函数式风格-GenericApplicationContext" class="headerlink" title="6.3 核心容器支持函数式风格 GenericApplicationContext"></a>6.3 核心容器支持函数式风格 GenericApplicationContext</h3><p>//函数式风格创建对象，交给spring进行管理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="comment">//创建GenericApplicationContext对象</span></span><br><span class="line">    GenericApplicationContext context = <span class="keyword">new</span> GenericApplicationContext();</span><br><span class="line">    <span class="comment">//调用context注册对象</span></span><br><span class="line">    context.refresh();</span><br><span class="line">    <span class="comment">//context.registerBean(User.class,() -&gt; new User()); //支持Lambda表达式</span></span><br><span class="line">    context.registerBean(<span class="string">"user1"</span>,User<span class="class">.<span class="keyword">class</span>,() -&gt; <span class="title">new</span> <span class="title">User</span>())</span>; <span class="comment">//也可以指定名称</span></span><br><span class="line">    <span class="comment">//获取spring注册的对象</span></span><br><span class="line">    <span class="comment">//User user = (User)context.getBean("cc.landfill.pojo.User");</span></span><br><span class="line">    User user = (User)context.getBean(<span class="string">"user1"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-支持整合Junit5"><a href="#6-4-支持整合Junit5" class="headerlink" title="6.4 支持整合Junit5"></a>6.4 支持整合Junit5</h3><p>（1） 整合Junit4<br>引入相关的针对测试的依赖<br>创建测试类，使用注解方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)  //指定单元测试框架的版本</span></span><br><span class="line">@ContextConfiguration("classpath:bean1.xml") //加载配置文件</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JunitTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span>   <span class="comment">//就可以自动注入，不需要再使用getBean()</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        accountService.transact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2） 整合Junit5<br>导入junit5的依赖<br>使用注解<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="comment">@ContextConfiguration("classpath:bean1.xml")*/</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">@SpringJUnitConfig</span>(locations =<span class="string">"classpath:bean1.xml"</span>)  <span class="comment">//使用复合注解替代上面的两个注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Junit5Test</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        accountService.transact();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="6-5-WebFlux"><a href="#6-5-WebFlux" class="headerlink" title="6.5 WebFlux"></a>6.5 WebFlux</h3><p>简介：<br>响应式编程<br>WebFlux执行流程和核心API</p>
<p>SpringWebflux(基于注解编程模型)<br>SpringWebflux(基于函数式编程模型)</p>
<p>需要基于：（暂时搁置）<br>SpringMVC<br>SpringBoot<br>Maven<br>Java8新特性 Lambda表达式 StreamAPI</p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/paranoiddemon.github.io/tags/Java/">Java</a>
		  
			<a href="/paranoiddemon.github.io/tags/Spring/">Spring</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/paranoiddemon.github.io/posts/gravestone">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">DIGITAL GRAVEYARD</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/paranoiddemon.github.io/posts/mybatis-notes">
        <span class="next-text nav-default">Mybatis 框架初步</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
    2020
    <span class="footer-author">Demon.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear" target="_blank" rel="noopener">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    
  





  
    <script type="text/javascript" src="/paranoiddemon.github.io/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/paranoiddemon.github.io/lib/fancybox/jquery.fancybox.pack.js"></script>
  

    <script type="text/javascript" src="/paranoiddemon.github.io/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/paranoiddemon.github.io/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
